---
title: "Lab 4 - Checkpoint 1"
author: "Arnaldo Gualberto"
date: "20/05/2017"
output: 
  html_document:
    smart: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

* Para cada uma delas, há uma diferença significativa na sua popularidade durante a semana e durante o fim de semana? 
* Existe uma diferença significativa na variação da popularidade das duas quando você compara o quanto a popularidade de cada uma varia durante os dias da semana?

# 0. Includes e Settings
```{r}
library(dplyr, warn.conflicts = FALSE)
library(ggplot2)
library(lubridate, warn.conflicts = FALSE)
library(readr)
library(resample)
source("multiplot.R")
```

# 1. Carregamento e limpeza dos dados
```{r}
dados_github <- read_csv("data/github-data.csv")
names(dados_github) <- c("extensao", "dia", "mes", "ano", "usuarios")
glimpse(dados_github)
```

```{r}
dados_clean <- dados_github %>%
  mutate(data = ymd(paste(ano, mes, dia)), dia_da_semana = wday(data, label = T))

glimpse(dados_clean)
```

# 2. Análise Descritiva

```{r, fig.width=12, fig.height=6}
dados_python <- dados_clean %>%
  filter(extensao == "py")

summary(dados_python)
```

```{r}
dados_c <- dados_clean %>%
  filter(extensao == "c")

summary(dados_c)
```

```{r}
dados_python %>%
  ggplot(aes(x=usuarios)) +
  geom_density() +
  geom_vline(xintercept = mean(dados_python$usuarios))
```

Em geral, aproximadamente 2500 ou 4700 usuários contribuem com códigos python diariamente.

```{r}
dados_c %>%
  ggplot(aes(x=usuarios)) +
  geom_density() +
  geom_vline(xintercept = mean(dados_c$usuarios))
```

Já em arquivos tff, aproximadamente 530 usuários.

```{r, fig.width=12}
dados_py_c <- dados_clean %>%
  filter(extensao == "py" | extensao == "c")

dados_py_c %>%
  group_by(extensao, ano, mes) %>%
  summarise(total = sum(usuarios)) %>%
  ggplot(aes(x = paste(ano, sprintf("%02d", mes)), y = total, fill = extensao)) +
  geom_bar(stat = "identity", position = "dodge")

```


```{r, fig.width=12}
plot_python <- dados_python %>%
  group_by(dia_da_semana) %>%
  summarise(total_usuarios = sum(usuarios)) %>%
  ggplot(aes(x = dia_da_semana, y = total_usuarios)) +
  geom_bar(stat = "identity")

plot_c <- dados_c %>%
  group_by(dia_da_semana) %>%
  summarise(total_usuarios = sum(usuarios)) %>%
  ggplot(aes(x = dia_da_semana, y = total_usuarios)) +
  geom_bar(stat = "identity")

multiplot(plot_python, plot_c, cols = 2)
```

```{r}
plot_python <- dados_python %>%
  ggplot(aes(x = dia_da_semana, y = usuarios)) +
  geom_point(alpha = 0.2)

plot_c <- dados_c %>%
  ggplot(aes(x = dia_da_semana, y = usuarios)) +
  geom_point(alpha = 0.2)

multiplot(plot_python, plot_c, cols = 2)
```

```{r}
dados_py_c %>%
  ggplot(aes(x = dia_da_semana, y = usuarios, color = extensao)) +
  geom_point(alpha = 0.3)
```

```{r}
dados_python %>%
  ggplot(aes(x = mes, y = dia_da_semana)) +
  geom_tile(aes(fill = usuarios)) 
```

```{r, fig.width=12}
dados_python_fds <- dados_python %>% filter(dia_da_semana == "Sat" | dia_da_semana == "Sun")
dados_python_dds <- dados_python %>% filter(dia_da_semana != "Sat" & dia_da_semana != "Sun")
dados_c_fds <- dados_c %>% filter(dia_da_semana == "Sat" | dia_da_semana == "Sun")
dados_c_dds <- dados_c %>% filter(dia_da_semana != "Sat" & dia_da_semana != "Sun")

plot_python_fds <- dados_python_fds %>%
  ggplot(aes(x = usuarios)) +
  geom_histogram(bins=30)

plot_python_dds <- dados_python_dds %>%
  ggplot(aes(x = usuarios)) +
  geom_histogram(bins=30)

plot_c_fds <- dados_c_fds %>%
  ggplot(aes(x = usuarios)) +
  geom_histogram(bins=30)

plot_c_dds <- dados_c_dds %>%
  ggplot(aes(x = usuarios)) +
  geom_histogram(bins=30)

multiplot(plot_python_dds, plot_python_fds, plot_c_dds, plot_c_fds, cols = 2)
```


# 3. Inferência Estatística

Como os dados que temos representam apenas uma amostra da população, teremos de efetuar o _bootstrap_ para estimar estatísticas da população, calcular os intervalos de confiança e, consequentemente, compará-las. Neste trabalho vamos estimar a média da população.

## 3.1 Comparação da popularidade entre fim de semana e dias de semana para cada linguagem

```{r}
repeticoes = 4000

exp_com_bootstrap <- function(x)
{
  boot_x <- sample(x, size = NROW(x), replace = TRUE) # aqui é o bootstrap
  return(mean(boot_x))
}

experimentos = data_frame(i = 1:repeticoes) %>%
  rowwise() %>%
  mutate(media_exp = exp_com_bootstrap(dados_python_fds$usuarios))

experimentos %>%
  ggplot(aes(x = media_exp)) +
  geom_histogram(binwidth = 1)
```

```{r, fig.width=12, fig.height=4}
mean.python_fds = bootstrap(dados_python_fds, mean(usuarios), R = 4000)
mean.python_dds = bootstrap(dados_python_dds, mean(usuarios), R = 4000)

plot_python_fds <- mean.python_fds$replicates %>%
  as.data.frame() %>%
  ggplot(aes(x = `mean(usuarios)`)) +
  geom_histogram(binwidth = 1) +
  geom_vline(xintercept = mean(dados_python_fds$usuarios), color = 'green')

plot_python_dds <- mean.python_dds$replicates %>%
  as.data.frame() %>%
  ggplot(aes(x = `mean(usuarios)`)) +
  geom_histogram(binwidth = 1) +
  geom_vline(xintercept = mean(dados_python_dds$usuarios), color = 'yellow')

multiplot(plot_python_fds, plot_python_dds, cols = 2)
```

```{r, fig.width=12, fig.height=4}
mean.c_fds = bootstrap(dados_c_fds, mean(usuarios), R = 4000)
mean.c_dds = bootstrap(dados_c_dds, mean(usuarios), R = 4000)

plot_c_fds <- mean.c_fds$replicates %>%
  as.data.frame() %>%
  ggplot(aes(x = `mean(usuarios)`)) +
  geom_histogram(binwidth = 1) +
  geom_vline(xintercept = mean(dados_c_fds$usuarios), color = 'green')

plot_c_dds <- mean.c_dds$replicates %>%
  as.data.frame() %>%
  ggplot(aes(x = `mean(usuarios)`)) +
  geom_histogram(binwidth = 1) +
  geom_vline(xintercept = mean(dados_c_dds$usuarios), color = 'yellow')

multiplot(plot_c_fds, plot_c_dds, cols = 2)
```


```{r}
ci.python_fds = mean.python_fds %>% CI.bca(probs = c(.025, .975))
ci.python_dds = mean.python_dds %>% CI.bca(probs = c(.025, .975))
ci.c_fds = mean.c_fds %>% CI.bca(probs = c(.025, .975))
ci.c_dds = mean.c_dds %>% CI.bca(probs = c(.025, .975))

df = data.frame(rbind(ci.python_fds, ci.python_dds, ci.c_fds, ci.c_dds), row.names = c("mean_python_fds", "mean_python_dds", "mean_c_fds", "mean_c_dds"))
df$medida = row.names(df)

df %>%
  ggplot(aes(x = medida, ymin = X2.5., ymax = X97.5.)) +
  geom_errorbar(width = .2)
```


